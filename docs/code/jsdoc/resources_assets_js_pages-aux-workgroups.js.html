<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: resources/assets/js/pages-aux-workgroups.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: resources/assets/js/pages-aux-workgroups.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import moment from 'moment';
import GLOBALS from '../../js/globals.js';

var fv;

$(function() {
    const instances = GLOBALS.initNumberInputs();

    fv = validateWorkgroup();

    function waitForIntl(callback) {
        if (typeof $.fn.dataTable.ext.order.intl === 'function') {
            callback();
        } else {
            setTimeout(() => waitForIntl(callback), 150);
        }
    }
    waitForIntl(() => {
        $.fn.dataTable.ext.order.intl('hu', {
            sensitivity: 'base'
        });
    });

    let dataTable = $('.datatables-workgroups').DataTable({
        ajax: '/api/workgroups',
        columns: [
            { data: 'id', visible: false, searchable: false },
            { data: 'workgroup_number' },
            { data: 'name' },
            { data: 'leader_name' },
            { data: 'labor_administrator_name' },
            { 
                data: 'deleted',
                render: function(data, type, row) {
                    if (type === 'display') {
                        return data ? '&lt;i class="fas fa-times text-danger">&lt;/i>' : '&lt;i class="fas fa-check text-success">&lt;/i>';
                    } else {
                        return data;
                    }
                }
            },
            { data: 'updated_by_name' },
            { 
                data: 'updated_at',
                render: function(data, type, row) {
                    return moment(data).format('YYYY.MM.DD HH:mm:ss');
                }
            },
            { data: 'created_by_name' },
            { 
                data: 'created_at',
                render: function(data, type, row) {
                    return moment(data).format('YYYY.MM.DD HH:mm:ss');
                }
            },
            { data: '' }
        ],
        columnDefs: [
            {
                // For Responsive
                targets: 0,
                className: 'control',
                orderable: false,
                responsivePriority: 2,
                searchable: false,
                render: function(data, type, full, meta) {
                    return '';
                }
            },
            {
                // Actions
                targets: -1,
                title: window.isLeaderOfWg912 ? 'Műveletek' : '',
                orderable: false,
                searchable: false,
                render: function(data, type, full, meta) {
                    if (window.isLeaderOfWg912) {
                        return (
                            '&lt;div class="d-inline-block">' +
                            '&lt;a href="javascript:;" class="btn btn-sm text-primary btn-icon dropdown-toggle hide-arrow" data-bs-toggle="dropdown">&lt;i class="bx bx-dots-vertical-rounded">&lt;/i>&lt;/a>' +
                            '&lt;ul class="dropdown-menu dropdown-menu-end">' +
                            (!full.deleted ? '&lt;li>&lt;a href="javascript:;" class="dropdown-item modify-workgroup" data-bs-toggle="offcanvas" data-bs-target="#new_workgroup">Módosítás&lt;/a>&lt;/li>' : '') +
                            (full.deleted ? '&lt;li>&lt;a href="javascript:;" class="dropdown-item restore-workgroup">Visszaállítás&lt;/a>&lt;/li>' : '') +
                            (!full.deleted ? '&lt;div class="dropdown-divider">&lt;/div>&lt;li>&lt;a href="javascript:;" class="dropdown-item text-danger delete-workgroup">Törlés&lt;/a>&lt;/li>' : '') +
                            '&lt;/ul>' +
                            '&lt;/div>'
                        );
                    } else {
                        return '';
                    }
                }
            }
        ],
        order: [[1, 'asc']],
        displayLength: 10,
        lengthMenu: [10, 25, 50, 75, 100],
        dom: window.isLeaderOfWg912 
            ? '&lt;"card-header"&lt;"head-label text-center">&lt;"dt-action-buttons text-end"B>>&lt;"d-flex justify-content-between align-items-center row"&lt;"col-sm-12 col-md-6"l>&lt;"col-sm-12 col-md-6"f>>t&lt;"d-flex justify-content-between row"&lt;"col-sm-12 col-md-6"i>&lt;"col-sm-12 col-md-6"p>>'
            : '&lt;"d-flex justify-content-between align-items-center row"&lt;"col-sm-12 col-md-6"l>&lt;"col-sm-12 col-md-6"f>>t&lt;"d-flex justify-content-between row"&lt;"col-sm-12 col-md-6"i>&lt;"col-sm-12 col-md-6"p>>',
        buttons: [
            {
                text: '&lt;i class="bx bx-plus me-1">&lt;/i> &lt;span class="d-none d-lg-inline-block">Új csoport&lt;/span>',
                className: 'create-new btn btn-primary',
                attr: {
                    'data-bs-toggle': 'offcanvas',
                    'data-bs-target': '#new_workgroup'
                },
            }
        ],
        responsive: {
            details: {
                display: $.fn.dataTable.Responsive.display.modal({
                    header: function(row) {
                        var data = row.data();
                        return 'Details of ' + data['full_name'];
                    }
                }),
                type: 'column',
                renderer: function(api, rowIdx, columns) {
                    var data = $.map(columns, function(col, i) {
                        return col.title !== '' // ? Do not show row in modal popup if title is blank (for check box)
                        ? '&lt;tr data-dt-row="' +
                            col.rowIndex +
                            '" data-dt-column="' +
                            col.columnIndex +
                            '">' +
                            '&lt;td>' +
                            col.title +
                            ':' +
                            '&lt;/td> ' +
                            '&lt;td>' +
                            col.data +
                            '&lt;/td>' +
                            '&lt;/tr>'
                        : '';
                    }).join('');

                    return data ? $('&lt;table class="table"/>&lt;tbody />').append(data) : false;
                }
            }
        },
        language: GLOBALS.DATATABLE_TRANSLATION,
        initComplete: function() {
            var checkboxHtml = `
                &lt;div class="form-check form-switch show-inactive">
                    &lt;input class="form-check-input" type="checkbox" role="switch" id="show_inactive">
                    &lt;label class="form-check-label" for="show_inactive">Inaktívak megjelenítése&lt;/label>
                &lt;/div>
            `;
            var parent = $(this).closest('.dataTables_wrapper').find('.dataTables_length').parent();
            parent.css('display', 'flex').css('align-items', 'center');
            parent.find('.dataTables_length').css('margin-right', '20px');
            parent.find('.dataTables_length').after(checkboxHtml);

            $('#show_inactive').on('change', function() {
                $('.datatables-workgroups').DataTable().draw();
            });
        }
    });

    // refresh number of rows on show inactive checkbox change
    $.fn.dataTable.ext.search.push(
        function(settings, data, dataIndex) {
            let showInactive = $('#show_inactive').prop('checked');
            let isInactive = dataTable.row(dataIndex).data().deleted;
            if (showInactive) {
                return true;
            } else {
                return !isInactive;
            }
        }
    );

    // Filter form control to default size
    // ? setTimeout used for multilingual table initialization
    setTimeout(() => {
        $('.dataTables_filter .form-control').removeClass('form-control-sm');
        $('.dataTables_length .form-select').removeClass('form-select-sm');
    }, 300);

    // delete workgroup
    $(document).on('click', '.delete-workgroup', function() {
        var row = $(this).closest('tr');
        var workgroupId = $('.datatables-workgroups').DataTable().row(row).data().id;

        $('#confirm_delete').attr('data-workgroup-id', workgroupId);
        $('#deleteConfirmation').modal('show');
    });

    // confirm delete workgroup
    $('#confirm_delete').on('click', function () {
        var workgroupId = $(this).data('workgroup-id');

        $.ajax({
            url: '/api/workgroup/' + workgroupId + '/delete',
            type: 'POST',
            data: {
                _token: $('meta[name="csrf-token"]').attr('content')
            },
            success: function (response) {
                window.location.reload();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                if (jqXHR.status === 401 || jqXHR.status === 419) {
                    alert('Lejárt a munkamenet. Kérjük, jelentkezz be újra.');
                    window.location.href = '/login';
                }

                $('#deleteConfirmation').modal('hide');
                GLOBALS.AJAX_ERROR('Hiba történt a törlés során!', jqXHR, textStatus, errorThrown);
            }
        });
    });

    //restore workgroup
    $(document).on('click', '.restore-workgroup', function() {
        var row = $(this).closest('tr');
        var workgroupId = $('.datatables-workgroups').DataTable().row(row).data().id;

        $('#confirm_restore').attr('data-workgroup-id', workgroupId);
        $('#restoreConfirmation').modal('show');
    });

    // confirm restore workgroup
    $('#confirm_restore').on('click', function () {
        var workgroupId = $(this).data('workgroup-id');

        $.ajax({
            url: '/api/workgroup/' + workgroupId + '/restore',
            type: 'POST',
            data: {
                _token: $('meta[name="csrf-token"]').attr('content')
            },
            success: function (response) {
                window.location.reload();
            },
            error: function (jqXHR, textStatus, errorThrown) {
                if (jqXHR.status === 401 || jqXHR.status === 419) {
                    alert('Lejárt a munkamenet. Kérjük, jelentkezz be újra.');
                    window.location.href = '/login';
                }

                $('#restoreConfirmation').modal('hide');
                GLOBALS.AJAX_ERROR('Hiba történt a visszaállítás során!', jqXHR, textStatus, errorThrown);
            }
        });
    });

    // modify workgroup
    $(document).on('click', '.modify-workgroup', function() {
        var row = $(this).closest('tr');
        var workgroup = $('.datatables-workgroups').DataTable().row(row).data();

        $('#new_workgroup_label').text('Csoport módosítás');

        $('#new_workgroup #workgroup_number').val(workgroup.workgroup_number);
        $('#new_workgroup #name').val(workgroup.name);
        $('#new_workgroup #leader_id').val(workgroup.leader_id).trigger('change');
        $('#new_workgroup #labor_administrator').val(workgroup.labor_administrator).trigger('change');
        $('.data-submit').attr('data-workgroup-id', workgroup.id);

        fv.revalidateField('workgroup_number');
        fv.revalidateField('name');
    });

    // submit workgroup
    $('.data-submit').on('click', function() {
        var workgroupId = $(this).data('workgroup-id');
        var url = workgroupId ? '/api/workgroup/' + workgroupId + '/update' : '/api/workgroup/create';

        fv.validate().then(function(status) {
            if(status === 'Valid') {
                // Disable the button to prevent double clicks
                $(".data-submit").prop('disabled', true);
                
                $.ajax({
                    url: url,
                    type: 'POST',
                    data: {
                        _token: $('meta[name="csrf-token"]').attr('content'),
                        workgroup_number: GLOBALS.cleanNumber($('#workgroup_number').val()),
                        name: $('#name').val(),
                        leader_id: $('#leader_id').val(),
                        labor_administrator: $('#labor_administrator').val(),
                        workgroupId: workgroupId
                    },
                    success: function (response) {
                        window.location.reload();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        if (jqXHR.status === 401 || jqXHR.status === 419) {
                            alert('Lejárt a munkamenet. Kérjük, jelentkezz be újra.');
                            window.location.href = '/login';
                        }
                        
                        var errors = jqXHR.responseJSON.errors;
                        if (errors) {
                            // Enable the button again
                            $(".data-submit").prop('disabled', false);
                            
                            // Validációs hibák megjelenítése a formon
                            Object.keys(errors).forEach(function(field) {
                                var inputField = $('#' + field);
                                if (inputField.length) {
                                    // Add invalid class to the input
                                    inputField.addClass('is-invalid');
                                    
                                    // Add feedback div after the input
                                    inputField.after('&lt;div class="invalid-feedback">' + errors[field][0] + '&lt;/div>');
                                }
                            });
                            
                            // Focus on the first field with error
                            var firstErrorField = Object.keys(errors)[0];
                            $('#' + firstErrorField).focus();
                        } else {
                            bootstrap.Offcanvas.getInstance(document.getElementById('new_workgroup')).hide();
                            $('.data-submit').attr('data-workgroup-id', null);
                            
                            var errorMessages = "";
                            if (jqXHR.responseJSON &amp;&amp; jqXHR.responseJSON.errors) {
                                for (var key in jqXHR.responseJSON.errors) {
                                    if (jqXHR.responseJSON.errors.hasOwnProperty(key)) {
                                        errorMessages += jqXHR.responseJSON.errors[key] + '&lt;br>';
                                    }
                                }
                            } else {
                                errorMessages = "Hiba történt a mentés során!";
                            }
                            GLOBALS.AJAX_ERROR(errorMessages, jqXHR, textStatus, errorThrown);
                        }
                    }
                });
            }
        });
    });

    $('.create-new').on('click', function() {
        $('#new_workgroup_label').text('Új csoport');
        $('.data-submit').attr('data-workgroup-id', null);
        $('#workgroup_number').val('');
        $('#name').val('');
        $('#leader_id').val($('#leader_id option:first').val()).trigger('change');
        $('#labor_administrator').val($('#labor_administrator option:first').val()).trigger('change');

        fv?.resetForm(true);
    });
});

/**
 * Validates the health allowance form.
 * @returns {FormValidation.FormValidationInstance} – FormValidation instance
 * @description
 * This function sets up validation for the health allowance form fields.
 * It checks that all required fields are filled out and displays error messages
 * if any fields are left empty. The validation is done using the FormValidation library.
 */
function validateWorkgroup() {
    return FormValidation.formValidation(
        document.getElementById('new_workgroup'),
        {
            fields: {
                workgroup_number: {
                    validators: {
                        notEmpty: {
                            message: 'Kérjük, add meg a csoportszámot'
                        },
                        between: {
                            min: 100,
                            max: 999,
                            message: 'A csoportszámnak 100 és 999 között kell lennie'
                        },
                        remote: {
                            url: '/api/workgroup/check-unique',
                            method: 'POST',
                            data: function() {
                                return {
                                    _token: $('meta[name="csrf-token"]').attr('content'),
                                    workgroup_number: GLOBALS.cleanNumber($('#workgroup_number').val()),
                                    workgroup_id: $('.data-submit').data('workgroup-id') || null
                                };
                            },
                            message: 'Ez a csoportszám már használatban van'
                        }
                    }
                },
                name: {
                    validators: {
                        notEmpty: {
                            message: 'Kérjük, add meg a csoport nevét'
                        },
                        stringLength: {
                            max: 255,
                            message: 'A csoport neve maximum 255 karakter hosszú lehet'
                        },
                        regexp: {
                            regexp: /^[a-zA-ZáéíóöőúüűÁÉÍÓÖŐÚÜŰ\s,-]+$/,
                            message: 'A csoport neve csak betűket, szóközt, vesszőt és kötőjelet tartalmazhat'
                        },
                        remote: {
                            url: '/api/workgroup/check-name-unique',
                            method: 'POST',
                            data: function() {
                                return {
                                    _token: $('meta[name="csrf-token"]').attr('content'),
                                    name: $('#name').val(),
                                    workgroup_id: $('.data-submit').data('workgroup-id') || null
                                };
                            },
                            message: 'Ez a csoport név már használatban van'
                        }
                    }
                },
                leader_id: {
                    validators: {
                        notEmpty: {
                            message: 'Kérjük, válassz csoportvezetőt'
                        }
                    }
                },
                labor_administrator: {
                    validators: {
                        notEmpty: {
                            message: 'Kérjük, válassz munkaügyi ügyintézőt'
                        }
                    }
                }
            },
            plugins: {
                trigger: new FormValidation.plugins.Trigger({
                    event: {
                        workgroup_number: 'blur',
                        name: 'blur',
                        leader_id: 'change',
                        labor_administrator: 'change'
                    },
                }),
                bootstrap: new FormValidation.plugins.Bootstrap5(),
                autoFocus: new FormValidation.plugins.AutoFocus(),
            },
        }
    );
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#calculateDuration">calculateDuration</a></li><li><a href="global.html#calculateYearlyAmounts">calculateYearlyAmounts</a></li><li><a href="global.html#citizenshipPopover">citizenshipPopover</a></li><li><a href="global.html#dynamicControls">dynamicControls</a></li><li><a href="global.html#enableOnChange">enableOnChange</a></li><li><a href="global.html#filterByPosition">filterByPosition</a></li><li><a href="global.html#filterByWorkgroups">filterByWorkgroups</a></li><li><a href="global.html#filterCostCenters">filterCostCenters</a></li><li><a href="global.html#filterExternalAccess">filterExternalAccess</a></li><li><a href="global.html#filterPositionOptions">filterPositionOptions</a></li><li><a href="global.html#filterRoomOptions">filterRoomOptions</a></li><li><a href="global.html#filterStudentStatus">filterStudentStatus</a></li><li><a href="global.html#formatNumber">formatNumber</a></li><li><a href="global.html#getEmployerContribution">getEmployerContribution</a></li><li><a href="global.html#getGrossSalarySum">getGrossSalarySum</a></li><li><a href="global.html#handleChemicalHazardsVisibility">handleChemicalHazardsVisibility</a></li><li><a href="global.html#handleChemicalsExposureVisibility">handleChemicalsExposureVisibility</a></li><li><a href="global.html#handleMainFieldVisibility">handleMainFieldVisibility</a></li><li><a href="global.html#handleSubFieldVisibility">handleSubFieldVisibility</a></li><li><a href="global.html#hideChemicalSubfields">hideChemicalSubfields</a></li><li><a href="global.html#initCoverageTable">initCoverageTable</a></li><li><a href="global.html#isMainField">isMainField</a></li><li><a href="global.html#isSubField">isSubField</a></li><li><a href="global.html#parseSalaryValue">parseSalaryValue</a></li><li><a href="global.html#resetChemicalFields">resetChemicalFields</a></li><li><a href="global.html#resetSubfields">resetSubfields</a></li><li><a href="global.html#revalidateOnChange">revalidateOnChange</a></li><li><a href="global.html#setWorkingHours">setWorkingHours</a></li><li><a href="global.html#setWorkingHoursWeekdays">setWorkingHoursWeekdays</a></li><li><a href="global.html#syncCostCenterOptions">syncCostCenterOptions</a></li><li><a href="global.html#syncWorkgroupOptions">syncWorkgroupOptions</a></li><li><a href="global.html#toggleApplicantCountInputs">toggleApplicantCountInputs</a></li><li><a href="global.html#toggleTaskInput">toggleTaskInput</a></li><li><a href="global.html#updateAvailableTools">updateAvailableTools</a></li><li><a href="global.html#updateCoverageTable">updateCoverageTable</a></li><li><a href="global.html#updateEndDateBasedOnPosition">updateEndDateBasedOnPosition</a></li><li><a href="global.html#updateInventoryNumbersOfAvailableTools">updateInventoryNumbersOfAvailableTools</a></li><li><a href="global.html#updateTotals">updateTotals</a></li><li><a href="global.html#validateCostCenter">validateCostCenter</a></li><li><a href="global.html#validateCostCenterSum">validateCostCenterSum</a></li><li><a href="global.html#validateCostCenterType">validateCostCenterType</a></li><li><a href="global.html#validateDelegation">validateDelegation</a></li><li><a href="global.html#validateEmployeeRecruitment">validateEmployeeRecruitment</a></li><li><a href="global.html#validateExternalAccess">validateExternalAccess</a></li><li><a href="global.html#validateExternalPrivilege">validateExternalPrivilege</a></li><li><a href="global.html#validateHealthAllowance">validateHealthAllowance</a></li><li><a href="global.html#validateInstitute">validateInstitute</a></li><li><a href="global.html#validatePosition">validatePosition</a></li><li><a href="global.html#validateWorkdayTimes">validateWorkdayTimes</a></li><li><a href="global.html#validateWorkgroup">validateWorkgroup</a></li><li><a href="global.html#validateWorkingHours">validateWorkingHours</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Fri Jun 20 2025 12:46:55 GMT+0200 (közép-európai nyári idő)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
